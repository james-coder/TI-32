<!doctype html>
<html lang="en">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>TI-32 Web Flasher</title>
    <link rel="preconnect" href="https://fonts.googleapis.com" />
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
    <link
      href="https://fonts.googleapis.com/css2?family=Space+Grotesk:wght@400;500;600;700&family=Source+Code+Pro:wght@400;600&display=swap"
      rel="stylesheet"
    />
    <link rel="stylesheet" href="styles.css" />
    <script type="module" src="https://unpkg.com/esp-web-tools@10/dist/web/install-button.js?module"></script>
  </head>
  <body>
    <div class="page">
      <header class="hero" data-reveal style="--delay: 0.05s">
        <div class="pill">ESP32-C3 | Web Serial</div>
        <h1>TI-32 Web Flasher</h1>
        <p class="lede">
          Flash the latest TI-32 firmware to a stock Seeeduino XIAO ESP32C3 using your browser.
        </p>
        <div class="hero-actions">
          <esp-web-install-button manifest="manifest.json">
            <button class="cta" slot="install">Install Firmware</button>
          </esp-web-install-button>
          <button class="ghost" type="button" id="copy-steps">Copy Boot Steps</button>
        </div>
        <div class="hero-meta">
          <div class="meta">
            <span class="label">Firmware</span>
            <span class="value" id="fw-version">--</span>
          </div>
          <div class="meta">
            <span class="label">Chip</span>
            <span class="value" id="fw-chip">ESP32-C3</span>
          </div>
          <div class="meta">
            <span class="label">Status</span>
            <span class="value" id="fw-status">Loading...</span>
          </div>
        </div>
      </header>

      <main class="grid">
        <section class="card" data-reveal style="--delay: 0.15s">
          <h2>1. Enter Bootloader</h2>
          <ol>
            <li>Plug the XIAO ESP32C3 into USB.</li>
            <li>Hold <strong>BOOT</strong>, tap <strong>RESET</strong>, then release BOOT.</li>
            <li>Keep the USB cable connected during flashing.</li>
          </ol>
          <div class="hint">On macOS/Windows, the port will appear as a USB serial device.</div>
        </section>

        <section class="card" data-reveal style="--delay: 0.25s">
          <h2>2. Flash in the Browser</h2>
          <ol>
            <li>Click <strong>Install Firmware</strong> above.</li>
            <li>Select the serial port for the XIAO ESP32C3.</li>
            <li>Wait for "Flash complete", then tap RESET.</li>
          </ol>
          <div class="callout" id="browser-warning">
            This installer requires Chrome, Edge, or another Chromium browser with Web Serial.
          </div>
        </section>

        <section class="card" data-reveal style="--delay: 0.35s">
          <h2>3. First Boot</h2>
          <ol>
            <li>The ESP32 starts a setup AP if it can't connect.</li>
            <li>Join <code>TI-32-SETUP-XXXX</code> and open <code>192.168.4.1</code>.</li>
            <li>Save Wi-Fi and server settings, then reboot.</li>
          </ol>
          <div class="hint">Tip: you can update Wi-Fi later from the calculator menu.</div>
        </section>
      </main>

      <section class="banner" data-reveal style="--delay: 0.45s">
        <div>
          <h3>Need the firmware files?</h3>
          <p>
            This page flashes the binaries listed in <code>manifest.json</code>. Make sure the
            latest <code>bootloader.bin</code>, <code>partitions.bin</code>, and <code>firmware.bin</code>
            are present in <code>web-flasher/firmware</code> on the Netlify build.
          </p>
        </div>
        <a class="link" href="https://github.com/james-coder/TI-32/actions">Get build artifacts</a>
      </section>

      <section class="faq" data-reveal style="--delay: 0.55s">
        <h2>Quick Checks</h2>
        <div class="faq-grid">
          <div class="faq-item">
            <h4>Board not detected?</h4>
            <p>Try a different USB cable and make sure it supports data (not charge-only).</p>
          </div>
          <div class="faq-item">
            <h4>Flash fails?</h4>
            <p>Re-enter bootloader mode and close any other serial terminals.</p>
          </div>
          <div class="faq-item">
            <h4>Security note</h4>
            <p>This runs fully in your browser; it does not upload data to the server.</p>
          </div>
        </div>
      </section>

      <footer class="footer" data-reveal style="--delay: 0.65s">
        <span>TI-32 - Web Flasher</span>
        <span class="dot">-</span>
        <span>Designed for Seeeduino XIAO ESP32C3</span>
      </footer>
    </div>

    <script src="app.js"></script>
  </body>
</html>
